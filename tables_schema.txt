create table public.audit_logs (
  id uuid not null default gen_random_uuid (),
  staff_id uuid null,
  table_name text not null,
  record_id uuid null,
  action text null,
  description text null,
  created_at timestamp without time zone null default now(),
  constraint audit_logs_pkey primary key (id),
  constraint audit_logs_staff_id_fkey foreign KEY (staff_id) references staff (id),
  constraint audit_logs_action_check check (
    (
      action = any (
        array[
          'create'::text,
          'update'::text,
          'delete'::text,
          'login'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create table public.basket_services (
  id uuid not null default gen_random_uuid (),
  basket_id uuid null,
  service_id uuid null,
  rate numeric(10, 2) not null,
  subtotal numeric(10, 2) not null,
  status text null,
  constraint basket_services_pkey primary key (id),
  constraint basket_services_basket_id_service_id_key unique (basket_id, service_id),
  constraint basket_services_service_id_fkey foreign KEY (service_id) references services (id),
  constraint basket_services_basket_id_fkey foreign KEY (basket_id) references baskets (id) on delete CASCADE,
  constraint basket_services_rate_check check ((rate >= (0)::numeric)),
  constraint basket_services_status_check check (
    (
      status = any (
        array[
          'pending'::text,
          'in_progress'::text,
          'completed'::text
        ]
      )
    )
  ),
  constraint basket_services_subtotal_check check ((subtotal >= (0)::numeric))
) TABLESPACE pg_default;

create table public.baskets (
  id uuid not null default gen_random_uuid (),
  order_id uuid null,
  weight numeric(10, 2) null,
  notes text null,
  price numeric(10, 2) null,
  status text null default 'processing'::text,
  created_at timestamp without time zone null default now(),
  basket_number integer not null default 1,
  constraint baskets_pkey primary key (id),
  constraint baskets_order_id_fkey foreign KEY (order_id) references orders (id) on delete CASCADE,
  constraint baskets_status_check check (
    (
      status = any (
        array[
          'processing'::text,
          'completed'::text,
          'cancelled'::text
        ]
      )
    )
  ),
  constraint baskets_weight_check check ((weight > (0)::numeric))
) TABLESPACE pg_default;

create table public.customers (
  id uuid not null default gen_random_uuid (),
  auth_id uuid null,
  first_name text not null,
  middle_name text null,
  last_name text not null,
  birthdate date null,
  gender text null,
  address text null,
  phone_number text null,
  email_address text null,
  loyalty_points integer null default 0,
  created_at timestamp without time zone null default now(),
  constraint customers_pkey primary key (id),
  constraint customers_auth_id_key unique (auth_id),
  constraint customers_email_address_key unique (email_address),
  constraint customers_gender_check check (
    (
      gender = any (array['male'::text, 'female'::text])
    )
  )
) TABLESPACE pg_default;

create table public.inventory_transactions (
  id uuid not null default gen_random_uuid (),
  inventory_id uuid null,
  staff_id uuid null,
  customer_id uuid null,
  change_type text null,
  quantity numeric(10, 2) null,
  reason text null,
  created_at timestamp without time zone null default now(),
  constraint inventory_transactions_pkey primary key (id),
  constraint inventory_transactions_customer_id_fkey foreign KEY (customer_id) references customers (id),
  constraint inventory_transactions_inventory_id_fkey foreign KEY (inventory_id) references products (id),
  constraint inventory_transactions_staff_id_fkey foreign KEY (staff_id) references staff (id),
  constraint inventory_transactions_change_type_check check (
    (
      change_type = any (
        array[
          'add'::text,
          'remove'::text,
          'consume'::text,
          'adjust'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create table public.issues (
  id uuid not null default gen_random_uuid (),
  basket_id uuid null,
  description text null,
  status text null default 'processing'::text,
  severity text null default 'low'::text,
  resolved_by uuid null,
  resolved_at timestamp without time zone null,
  created_at timestamp without time zone null default now(),
  constraint issues_pkey primary key (id),
  constraint issues_basket_id_fkey foreign KEY (basket_id) references baskets (id) on delete CASCADE,
  constraint issues_resolved_by_fkey foreign KEY (resolved_by) references staff (id),
  constraint issues_severity_check check (
    (
      severity = any (array['low'::text, 'medium'::text, 'high'::text])
    )
  ),
  constraint issues_status_check check (
    (
      status = any (
        array[
          'processing'::text,
          'resolved'::text,
          'cancelled'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create table public.machines (
  id uuid not null default gen_random_uuid (),
  machine_name text not null,
  type text null,
  status text null default 'available'::text,
  last_serviced_at timestamp without time zone null,
  created_at timestamp without time zone null default now(),
  constraint machines_pkey primary key (id),
  constraint machines_status_check check (
    (
      status = any (
        array[
          'available'::text,
          'running'::text,
          'maintenance'::text
        ]
      )
    )
  ),
  constraint machines_type_check check (
    (
      type = any (array['wash'::text, 'dry'::text, 'iron'::text])
    )
  )
) TABLESPACE pg_default;

create table public.order_products (
  id uuid not null default gen_random_uuid (),
  order_id uuid not null,
  product_id uuid not null,
  quantity numeric(10, 2) not null default 1,
  unit_price numeric(10, 2) not null,
  subtotal numeric(10, 2) not null,
  created_at timestamp without time zone null default now(),
  constraint order_products_pkey primary key (id),
  constraint order_products_order_id_fkey foreign KEY (order_id) references orders (id) on delete CASCADE,
  constraint order_products_product_id_fkey foreign KEY (product_id) references products (id),
  constraint order_products_quantity_check check ((quantity > (0)::numeric)),
  constraint order_products_subtotal_check check ((subtotal >= (0)::numeric)),
  constraint order_products_unit_price_check check ((unit_price >= (0)::numeric))
) TABLESPACE pg_default;

create table public.order_status_history (
  id uuid not null default gen_random_uuid (),
  order_id uuid null,
  status text not null,
  changed_by uuid null,
  changed_at timestamp without time zone null default now(),
  constraint order_status_history_pkey primary key (id),
  constraint order_status_history_changed_by_fkey foreign KEY (changed_by) references staff (id),
  constraint order_status_history_order_id_fkey foreign KEY (order_id) references orders (id) on delete CASCADE
) TABLESPACE pg_default;

create table public.orders (
  id uuid not null default gen_random_uuid (),
  source text not null,
  customer_id uuid null,
  status text null default 'processing'::text,
  payment_status text null default 'successful'::text,
  total_amount numeric(10, 2) null default 0,
  discount numeric(10, 2) null default 0,
  pickup_address text null,
  delivery_address text null,
  shipping_fee numeric(10, 2) null default 0,
  created_at timestamp without time zone null default now(),
  completed_at timestamp without time zone null,
  constraint orders_pkey primary key (id),
  constraint orders_customer_id_fkey foreign KEY (customer_id) references customers (id),
  constraint orders_payment_status_check check (
    (
      payment_status = any (
        array[
          'processing'::text,
          'successful'::text,
          'failed'::text
        ]
      )
    )
  ),
  constraint orders_source_check check (
    (source = any (array['pos'::text, 'mobile'::text]))
  ),
  constraint orders_status_check check (
    (
      status = any (
        array[
          'processing'::text,
          'pick-up'::text,
          'delivering'::text,
          'completed'::text,
          'cancelled'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create table public.payments (
  id uuid not null default gen_random_uuid (),
  order_id uuid null,
  status text null default 'completed'::text,
  method text null,
  reference_number text null,
  amount numeric(10, 2) not null,
  created_at timestamp without time zone null default now(),
  constraint payments_pkey primary key (id),
  constraint payments_order_id_fkey foreign KEY (order_id) references orders (id) on delete CASCADE,
  constraint payments_amount_check check ((amount > (0)::numeric)),
  constraint payments_method_check check (
    (method = any (array['cash'::text, 'gcash'::text]))
  ),
  constraint payments_status_check check (
    (
      status = any (
        array[
          'pending'::text,
          'completed'::text,
          'failed'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create table public.products (
  id uuid not null default gen_random_uuid (),
  item_name text not null,
  unit text not null,
  unit_cost numeric(10, 2) not null default 0.00,
  unit_price numeric(10, 2) not null default 0.00,
  quantity numeric(10, 2) not null default 0,
  reorder_level numeric(10, 2) not null default 0,
  last_updated timestamp without time zone null default now(),
  constraint inventory_pkey primary key (id),
  constraint inventory_unit_cost_check check ((unit_cost >= (0)::numeric)),
  constraint inventory_unit_price_check check ((unit_price >= (0)::numeric))
) TABLESPACE pg_default;

create table public.services (
  id uuid not null default gen_random_uuid (),
  service_type text not null,
  name text not null,
  description text null,
  base_duration_minutes numeric null,
  rate_per_kg numeric(10, 2) null,
  is_active boolean null default true,
  constraint services_pkey primary key (id),
  constraint services_base_duration_minutes_check check ((base_duration_minutes >= (0)::numeric)),
  constraint services_rate_per_kg_check check ((rate_per_kg >= (0)::numeric)),
  constraint services_service_type_check check (
    (
      service_type = any (
        array[
          'wash'::text,
          'spin'::text,
          'dry'::text,
          'iron'::text,
          'fold'::text,
          'other'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create table public.staff (
  id uuid not null default gen_random_uuid (),
  auth_id uuid null,
  first_name text not null,
  middle_name text null,
  last_name text not null,
  birthdate date null,
  gender text null,
  role text not null,
  address text null,
  phone_number text null,
  email_address text null,
  is_active boolean null default true,
  created_at timestamp without time zone null default now(),
  updated_on timestamp without time zone null,
  updated_by uuid null,
  constraint staff_pkey primary key (id),
  constraint staff_auth_id_key unique (auth_id),
  constraint staff_email_address_key unique (email_address),
  constraint staff_updated_by_fkey foreign KEY (updated_by) references staff (id),
  constraint staff_gender_check check (
    (
      gender = any (array['male'::text, 'female'::text])
    )
  ),
  constraint staff_role_check check (
    (
      role = any (
        array[
          'admin'::text,
          'cashier'::text,
          'attendant'::text,
          'rider'::text,
          'cashier_attendant'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;